name: Main

on:
 workflow_dispatch 
 
jobs:

 CheckoutRepo:
 
  runs-on: [self-hosted, windows, x64]
  steps:
    - uses: actions/checkout@v3.3.0
    
 
 #ReplaceTokens:
 
  #needs: CheckoutRepo
  #strategy:
   #matrix:
    #target: [Dev, QA, Prod]
  #uses: ./.github/workflows/ReplaceTokens.yml
  #with:
   #target_environment: ${{matrix.target}}
   
   
 #UploadArtifacts:
  
  #needs: ReplaceTokens
  #runs-on: [self-hosted, windows, x64]
  #steps:  
   #- uses: actions/upload-artifact@v3.1.2
    # with:
     # name: artifacts
      #path: MyArtifacts/


 DeployToDev:
  
  needs: CheckoutRepo
  strategy:
   matrix:
    target: [Dev, QA, Prod]
  uses: ./.github/workflows/Deploy.yml
  with:
   target_environment: 'Dev'   
   
   
 DeployToQA:
  
  needs: DeployToDev
  strategy:
   matrix:
    target: [Dev, QA, Prod]
  uses: ./.github/workflows/Deploy.yml
  with:
   target_environment: 'QA'
   
 DeployToProd:
  
  needs: DeployToQA
  strategy:
   matrix:
    target: [Dev, QA, Prod]
  uses: ./.github/workflows/Deploy.yml
  with:
   target_environment: 'Prod'
